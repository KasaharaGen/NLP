Q: How should I set up the firewall and DHCP with an AirPort Extreme and Lion Server? I'm trying to set up a network using an AirPort Extreme as a router (connected to the WAN on one end and the LAN on the other). I understand that out of the box I will have a hardware firewall, and the ability to set up DHCP, but am unclear on what the best way to add the capabilities of Lion Server, or if there's even any advantage to doing so.
Specifically,
(1) I'd like to use Lion Server, rather than the AirPort Extreme for DHCP, mostly because the UI is much easier to use and provides finer control.
(2) I wonder if there's any reason to use Lion Server as the firewall, instead of or in addition to AirPort Extreme (or if that even makes sense).
Is there a best practice on how to set this up? Any suggestions on how to proceed would be appreciated.

A: To use the Lion server for DHCP, you need to simply turn off DHCP service on the AirPort Extreme and turn it on in Lion.
To use the Lion box as a firewall it will need to have two network ports - one for LAN and one for WAN. (Unless you want your LAN side to be provided wirelessly (which I don't recommend)).
I'm a big fan of OSX server and use it at home myself... so here are some other neat things you could do with a Lion server...
Set up your Lion server to provide DNS names and a domain. When using the Lion server to provide IP addresses (DHCP), you can also allow it to provide other info to the clients, like who's providing DNS. So rather than having to use IPs to refer to your machines, you can give them DNS names. This means you don't have to set up static IPs for each device and you don't have to remember IPs! DNS and domain name examples: macbook.mynetwork.net, airport.mynetwork.net, etc. (mynetwork.net being your domain)
Set up RADIUS authentication with WPA2 Enterprise for your wireless connection. You "pair" the AirPort Extreme with the Lion server. This means that people who want to use your WiFi have to log in with a user and password. The user authentication is handled by the Lion server - set up your users in the server's directory.
Set up your Lion server to provide software updates to your Macs This means that your server downloads all the updates from Apple and can then serve them to Macs on your network. Saving bandwidth and time (it's alot faster!) You'll need to either manually point the client Macs to the server for their updates or "bind" the Macs to the server in order to change the appropriate settings for this (which is a big topic best discussed elsewhere).
Have fun.

A: I'll bet you figure it out already now, but here's a solution I made here :


*

*ADSL modem in BRIDGE mode

*AEBS in 'share public IP'-mode so is acts as hardware firewall, router,
NAT ... blabla (10.0.0.1)
for NAT leave standard host open and NAT-PMP on

*TCP/IP (internet side) DHCP and fill in as first DNS server to 10.0.0.2
(your own server)

*Set DHCP as follow : DHCP start 10.0.0.2 DHCP end 10.0.0.3

*Lease 1 day

*DHCP reserve : 10.0.0.2 --> server (with real MAC address and server
configured as static 10.0.0.2)

*DHCP reserve : 10.0.0.3 --> BOGUS (with FAKE MAC address 00:00:00:00:00:01)

*DHCP at the server with
Range  10.0.0.2 to 10.0.0.254
Router 10.0.0.1
DNS-server 10.0.0.2


And your combination AEBS / OSX Server works fine together and dealing
DHCP / DNS / Firewall (just in case) / etc etc ...

A: There is no way to "simply" turn off DHCP on an Airport Extreme. The only way is to use Bridge mode, but then you lose the NAT. As a workaround, you can add a fake MAC to a reserved IP address. If you plan on using Guest networking, you'll need to do one for each simultaneous guest, because the DHCP ranges are tied together.
It's probably the worst part of the AEBS feature set.
